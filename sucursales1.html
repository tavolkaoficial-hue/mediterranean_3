<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel de Sucursales - Mediterranean</title>

<!-- Font Awesome para √≠conos -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<!-- Librer√≠as externas -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:transparent;
  color:var(--text);
  transition: background 0.3s,color 0.3s;
  overflow-x:hidden;
}
:root { --text:#fff; --card-bg:rgba(255,255,255,0.1); }
[data-theme="light"] { --text:#222; --card-bg:#fff; }

#background { position:fixed; top:0; left:0; width:100vw; height:100vh; background:linear-gradient(135deg,#004e92,#0a1f44); z-index:-2; }
#particles { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:-1; }

.logo-img { width: 150px; height:auto; display:block; animation:glow 4s ease-in-out infinite; }
@keyframes glow { 
  0% { filter:drop-shadow(0 0 5px #00eaff) drop-shadow(0 0 10px #f4c430); }
  50% { filter:drop-shadow(0 0 20px #00eaff) drop-shadow(0 0 40px #f4c430); }
  100% { filter:drop-shadow(0 0 5px #00eaff) drop-shadow(0 0 10px #f4c430); }
}

.theme-toggle {
  cursor:pointer;
  background:#f4c430;
  border:none;
  padding:6px 12px;
  border-radius:8px;
  font-weight:bold;
  position: fixed;
  top: 15px;
  right: 20px;
  z-index: 1100;
}

/* ==================== BARRA LATERAL ==================== */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 230px;
  height: 100%;
  background: linear-gradient(135deg, rgba(0,78,146,0.95), rgba(10,31,68,0.95));
  backdrop-filter: blur(12px);
  padding-top: 60px;
  z-index: 1000;
  box-shadow: 4px 0 20px rgba(0, 234, 255, 0.3);
  overflow: hidden;
}

.sidebar ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

.sidebar ul li {
  margin: 25px 0;
  text-align: left;
  padding-left: 25px;
}

.sidebar ul li a {
  color: #00eaff;
  text-decoration: none;
  font-weight: bold;
  font-size: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s ease;
}

.sidebar ul li a:hover {
  color: #f4c430;
  text-shadow: 0 0 10px #f4c430, 0 0 20px #f4c430;
}

.sidebar::before {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: conic-gradient(from 0deg, #00eaff, #f4c430, #00eaff);
  animation: rotateBg 8s linear infinite;
  z-index: -1;
  opacity: 0.15;
}

@keyframes rotateBg {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Ajustar contenido para que no quede debajo de la barra */
.container {
  margin-left: 250px;
  display:grid;
  grid-template-columns:1fr 2fr;
  gap:20px;
  padding:20px;
}

/* ==================== CONTENIDO ==================== */
.card { background:var(--card-bg); padding:15px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.3); }
.map-container { height: 250px; border-radius:15px; }
.notifications { max-height:150px; overflow-y:auto; font-size:14px; }
.chat-box { max-height:200px; overflow-y:auto; margin-bottom:10px; background:rgba(0,0,0,0.2); padding:10px; border-radius:10px; }
.chat-input { width:100%; padding:8px; border-radius:8px; border:none; }
.stars { color:gold; font-size:20px; }
input[type=text], textarea, input[type=password] { width:100%; padding:6px; margin-top:4px; margin-bottom:8px; border-radius:6px; border:1px solid #ccc; background:rgba(255,255,255,0.2); color:#fff; }
button.save-btn, button.login-btn { background:#00eaff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; font-weight:bold; color:#000; margin-top:4px; }

/* ==================== BIENVENIDA ==================== */
#welcome-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg,#004e92,#0a1f44);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  transition: opacity 1s ease;
}
#welcome-screen img { width: 300px; animation: glow 4s ease-in-out infinite; }
#welcome-screen.hidden { opacity: 0; pointer-events: none; visibility: hidden; }
</style>
</head>
<body>
<div id="background"></div>
<canvas id="particles"></canvas>

<!-- Pantalla de bienvenida -->
<div id="welcome-screen">
  <img src="images/LogoMediterranean1992.png" alt="Logo Bienvenida">
</div>

<!-- Barra lateral -->
<div class="sidebar">
  <ul>
    <li><a href="#"><i class="fa-solid fa-house"></i> Inicio</a></li>
    <li><a href="#"><i class="fa-solid fa-building"></i> Sucursales</a></li>
    <li><a href="#"><i class="fa-solid fa-user"></i> Usuarios</a></li>
    <li><a href="#"><i class="fa-solid fa-chart-line"></i> Reportes</a></li>
    <li><a href="#"><i class="fa-solid fa-gears"></i> Utilidades</a></li>
  </ul>
</div>

<!-- Bot√≥n de tema -->
<button class="theme-toggle" onclick="toggleTheme()">üåô Modo Claro</button>

<div class="container">
  <!-- Panel izquierdo -->
  <div>
    <div class="card">
      <h3>üîî Notificaciones</h3>
      <div class="notifications" id="notifications"></div>
    </div>
    <div class="card">
      <h3>üí¨ Chat interno</h3>
      <div class="chat-box" id="chatBox"></div>
      <input class="chat-input" id="chatInput" placeholder="Escribe un mensaje..." onkeydown="sendChat(event)">
    </div>
    <div class="card">
      <h3>‚≠ê Desempe√±o</h3>
      <p>Sucursal Centro Bogota: <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ</span></p>
      <p>Sucursal Keneddy: <span class="stars">‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ</span></p>
    </div>
  </div>

  <!-- Panel derecho -->
  <div>
    <div class="card map-container" id="map"></div>

    <div class="card" id="loginCard">
      <h3>üîë Login de Personal</h3>
      <input type="text" id="username" placeholder="Usuario">
      <input type="password" id="password" placeholder="Contrase√±a">
      <button class="login-btn" onclick="login()">Ingresar</button>
      <p id="loginMsg"></p>
    </div>

    <div class="card" id="changePassCard" style="display:none;">
      <h3>üîë Cambiar Contrase√±a</h3>
      <input type="password" id="oldPass" placeholder="Contrase√±a actual">
      <input type="password" id="newPass" placeholder="Nueva contrase√±a">
      <input type="password" id="confirmPass" placeholder="Confirmar nueva contrase√±a">
      <button class="save-btn" onclick="cambiarPassword()">Guardar Cambios</button>
      <p id="passMsg"></p>
    </div>

    <div class="card">
      <h3>üìå Detalles de Sucursal</h3>
      <div id="detalleSucursal">
        <p>Haz clic en una sucursal en el mapa para ver sus datos.</p>
      </div>
    </div>

    <div class="card">
      <h3>üìä Ventas y Stock</h3>
      <canvas id="dashboardChart"></canvas>
    </div>

    <div class="card">
      <h3>üìú Historial de movimientos</h3>
      <ul id="history"></ul>
    </div>
  </div>
</div>

<script>
// ================== BIENVENIDA ==================
window.addEventListener("load", () => {
  setTimeout(() => {
    document.getElementById("welcome-screen").classList.add("hidden");
  }, 2500);
});

// ================== USUARIOS ==================
let users = [
  { username:"admin", password:"admin2025", role:"admin" },
  { username:"supervisor", password:"super2025", role:"supervisor" },
  { username:"cajero", password:"cajero2025", role:"viewer" }
];
let currentUser = null;

// ================== THEME ==================
function toggleTheme(){
  let body=document.body;
  if(body.getAttribute("data-theme")==="light"){
    body.removeAttribute("data-theme");
    document.querySelector(".theme-toggle").innerText="üåô Modo Claro";
  } else {
    body.setAttribute("data-theme","light");
    document.querySelector(".theme-toggle").innerText="üåô Modo Oscuro";
  }
}

// ================== MAPA ==================
let map = L.map('map').setView([4.6195,-74.1673],14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom:18 }).addTo(map);

let sucursales = {
  "Keneddy": { coords:[4.6195,-74.1673], stock:120, ventas:90, direccion:"Calle 10 # 68-25, Barrio El Socorro, Kennedy", telefono:"+57 3219513533", supervisor:"Carlos P√©rez", horario:"Lunes a S√°bado 8:00am - 8:00pm", personal:["Cajeros","Vendedores","Seguridad","Limpieza"] },
  "Centro": { coords:[4.7110,-74.0721], stock:60, ventas:40, direccion:"Carrera 45 # 120-15, Usaqu√©n", telefono:"+57 601 7894561", supervisor:"Mar√≠a G√≥mez", horario:"Lunes a Domingo 9:00am - 7:00pm", personal:["Cajeros","Vendedores","Repartidores","Gerente"] }
};

for(let suc in sucursales){
  let marker = L.marker(sucursales[suc].coords).addTo(map);
  marker.on("click",()=>mostrarDetalles(suc));
}

function mostrarDetalles(nombre){
  let data = sucursales[nombre];
  let editable = (currentUser && (currentUser.role==="admin" || currentUser.role==="supervisor"));
  let detalle = `
    <h4>${nombre}</h4>
    <p><b>Direcci√≥n:</b> <input type="text" id="dir" value="${data.direccion}" ${editable?"":"disabled"}></p>
    <p><b>Tel√©fono:</b> <input type="text" id="tel" value="${data.telefono}" ${editable?"":"disabled"}></p>
    <p><b>Supervisor:</b> <input type="text" id="sup" value="${data.supervisor}" ${editable?"":"disabled"}></p>
    <p><b>Horario:</b> <input type="text" id="horario" value="${data.horario}" ${editable?"":"disabled"}></p>
    <p><b>Personal:</b> <textarea id="pers" ${editable?"":"disabled"}>${data.personal.join(", ")}</textarea></p>
    ${editable?'<button class="save-btn" onclick="guardarDetalles(\''+nombre+'\')">Guardar Cambios</button>':""}
  `;
  document.getElementById("detalleSucursal").innerHTML = detalle;
}

function guardarDetalles(nombre){
  sucursales[nombre].direccion = document.getElementById("dir").value;
  sucursales[nombre].telefono = document.getElementById("tel").value;
  sucursales[nombre].supervisor = document.getElementById("sup").value;
  sucursales[nombre].horario = document.getElementById("horario").value;
  sucursales[nombre].personal = document.getElementById("pers").value.split(",").map(s=>s.trim());
  alert("‚úÖ Detalles actualizados");
}

// ================== DASHBOARD ==================
let ctx = document.getElementById("dashboardChart").getContext("2d");
new Chart(ctx, {
  type:'bar',
  data:{
    labels:Object.keys(sucursales),
    datasets:[
      { label:'Stock', data:Object.values(sucursales).map(s=>s.stock), backgroundColor:'#f4c430' },
      { label:'Ventas', data:Object.values(sucursales).map(s=>s.ventas), backgroundColor:'#00eaff' }
    ]
  },
  options:{ responsive:true, plugins:{legend:{labels:{color:'var(--text)'}}}, scales:{ x:{ticks:{color:'var(--text)'}}, y:{ticks:{color:'var(--text)'}} } }
});

// ================== NOTIFICACIONES ==================
let notifications=document.getElementById("notifications");
function addNotification(msg){ let p=document.createElement("p"); p.innerText=msg; notifications.prepend(p); }
addNotification("‚ö†Ô∏è Stock bajo en Producto B - Sucursal Norte");
addNotification("‚úÖ Ventas diarias en Centro superaron el objetivo");
addNotification("‚úÖ ADSO, Analisis y Desarrollo de Software - Pedro Guevara");

// ================== CHAT ==================
let chatBox=document.getElementById("chatBox");
function sendChat(e){
  if(e.key==="Enter"){
    let input=document.getElementById("chatInput");
    if(input.value.trim()!==""){
      let msg=document.createElement("div");
      msg.innerText="üë§ Gerente: "+input.value;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
      input.value="";
    }
  }
}

// ================== HISTORIAL ==================
let history=document.getElementById("history");
let movimientos=["Entrada de 20 unidades de Producto A en Centro","Salida de 5 unidades de Producto C en Norte","Entrada de 15 unidades de Producto B en Centro"];
movimientos.forEach(m=>{ let li=document.createElement("li"); li.innerText=m; history.appendChild(li); });

// ================== PARTICULAS ==================
const canvas=document.getElementById("particles");
const ctxParticles=canvas.getContext("2d");
let particlesArray=[];
const numParticles=100;
const maxDistance=120;
const colors=["#00eaff","#f4c430"];
function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener("resize",resizeCanvas);
resizeCanvas();
class Particle{
  constructor(){ this.x=Math.random()*canvas.width; this.y=Math.random()*canvas.height; this.vx=(Math.random()-0.5)*1; this.vy=(Math.random()-0.5)*1; this.size=2; this.color=colors[Math.floor(Math.random()*colors.length)]; }
  update(){ this.x+=this.vx; this.y+=this.vy; if(this.x<0||this.x>canvas.width) this.vx*=-1; if(this.y<0||this.y>canvas.height) this.vy*=-1; }
  draw(){ ctxParticles.beginPath(); ctxParticles.arc(this.x,this.y,this.size,0,Math.PI*2); ctxParticles.fillStyle=this.color; ctxParticles.fill(); }
}
function initParticles(){ particlesArray=[]; for(let i=0;i<numParticles;i++){ particlesArray.push(new Particle()); } }
function connectParticles(){ for(let a=0;a<particlesArray.length;a++){ for(let b=a;b<particlesArray.length;b++){ let dx=particlesArray[a].x-particlesArray[b].x; let dy=particlesArray[a].y-particlesArray[b].y; let dist=Math.sqrt(dx*dx+dy*dy); if(dist<maxDistance){ ctxParticles.beginPath(); ctxParticles.strokeStyle="rgba(255,255,255,"+(1-dist/maxDistance)+")"; ctxParticles.lineWidth=0.5; ctxParticles.moveTo(particlesArray[a].x,particlesArray[a].y); ctxParticles.lineTo(particlesArray[b].x,particlesArray[b].y); ctxParticles.stroke(); } } } }
function animate(){ ctxParticles.clearRect(0,0,canvas.width,canvas.height); particlesArray.forEach(p=>{ p.update(); p.draw(); }); connectParticles(); requestAnimationFrame(animate); }
initParticles(); animate();

// ================== LOGIN ==================
function login(){
  let user=document.getElementById("username").value;
  let pass=document.getElementById("password").value;
  let found=users.find(u=>u.username===user && u.password===pass);
  let msg=document.getElementById("loginMsg");
  if(found){
    currentUser=found;
    msg.innerText="Bienvenido "+found.username+" ("+found.role+")";
    document.getElementById("loginCard").style.display="none";
    document.getElementById("changePassCard").style.display = (found.role==="admin"||found.role==="supervisor")?"block":"none";
  } else {
    msg.innerText="‚ùå Usuario o contrase√±a incorrectos";
  }
}

// ================== CAMBIO DE CONTRASE√ëA ==================
function cambiarPassword(){
  const oldPass=document.getElementById("oldPass").value;
  const newPass=document.getElementById("newPass").value;
  const confirmPass=document.getElementById("confirmPass").value;
  const msg=document.getElementById("passMsg");

  if(oldPass!==currentUser.password){ msg.innerText="‚ùå La contrase√±a actual es incorrecta."; return; }
  if(newPass.length<4){ msg.innerText="‚ùå La nueva contrase√±a debe tener al menos 4 caracteres."; return; }
  if(newPass!==confirmPass){ msg.innerText="‚ùå Las nuevas contrase√±as no coinciden."; return; }

  currentUser.password=newPass;
  msg.innerText="‚úÖ Contrase√±a cambiada correctamente.";
  document.getElementById("oldPass").value="";
  document.getElementById("newPass").value="";
  document.getElementById("confirmPass").value="";
}
</script>
</body>
</html>
