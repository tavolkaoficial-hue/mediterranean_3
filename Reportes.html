<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Premium - Mediterranean</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Librerías para exportar -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body, html { font-family: 'Inter', sans-serif; background:#0a1f3d; color:#e8f0f8; overflow-x:hidden; }
.sidebar { width:240px; position:fixed; top:0; left:0; height:100vh; background:linear-gradient(135deg,#050d1c,#0a1f3d); display:flex; flex-direction:column; gap:20px; padding-top:40px; box-shadow:2px 0 25px rgba(0,0,0,0.8); }
.sidebar a { color:#00f2fe; font-weight:bold; padding:12px 20px; margin:0 15px; border-radius:8px; display:flex; gap:10px; transition:all 0.3s; text-shadow:0 0 8px #00f2fe; }
.sidebar a:hover, .sidebar a.active { background: rgba(255,255,255,0.1); transform:translateX(6px) scale(1.05); }

.main-content { margin-left:260px; padding:80px 20px 20px; }
.container { background: rgba(0,0,0,0.3); backdrop-filter:blur(12px); padding:25px; border-radius:20px; box-shadow:0 8px 25px rgba(0,0,0,0.4); }

.table-container { max-height:400px; overflow-y:auto; border-radius:15px; margin-top:20px; }
table { width:100%; border-collapse:collapse; }
th, td { padding:12px; text-align:center; }
th { background:rgba(14,165,233,0.8); color:white; position:sticky; top:0; }
tbody tr:nth-child(even) { background: rgba(255,255,255,0.05); }
tbody tr:hover { background: rgba(0,242,254,0.2); }

input, select, textarea { padding:10px 12px; border-radius:10px; border:none; outline:none; background:rgba(255,255,255,0.1); color:white; }
.btn { padding:8px 16px; border-radius:8px; font-weight:bold; cursor:pointer; transition:all 0.3s; }
.btn-export { background:linear-gradient(90deg,#0ea5e9,#2563eb); color:white; }
.btn-export:hover { transform:scale(1.05); box-shadow:0 0 15px #0ea5e9; }
.btn-edit { background:#facc15; color:#000; }
.btn-delete { background:#ef4444; color:white; }

.stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:20px; }
.stat-card { background:rgba(14,165,233,0.1); padding:20px; border-radius:16px; text-align:center; box-shadow:0 0 15px rgba(14,165,233,0.3); transition:all 0.3s; }
.stat-card:hover { transform:translateY(-4px); box-shadow:0 0 25px rgba(14,165,233,0.6); }

/* Modal */
.modal { display:none; position:fixed; z-index:10000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); backdrop-filter:blur(4px); justify-content:center; align-items:center; }
.modal-content { background:#1e293b; color:white; padding:25px; border-radius:15px; width:90%; max-width:600px; position:relative; }
.close-modal { position:absolute; top:15px; right:20px; font-size:24px; cursor:pointer; color:#0ea5e9; }
.close-modal:hover { color:#fff; }

/* Toast notifications */
.toast { position:fixed; bottom:20px; right:20px; background:rgba(14,165,233,0.9); padding:12px 20px; border-radius:10px; color:white; opacity:0; transition:all 0.5s; z-index:9999; }
.toast.show { opacity:1; transform:translateY(-10px); }
</style>
</head>
<body>

<div class="sidebar">
  <a href="#"><i class="fas fa-home"></i> Menu Principal</a>
  <a href="#"><i class="fas fa-boxes"></i> Productos</a>
  <a href="#"><i class="fas fa-store"></i> Sucursales</a>
  <a href="#"><i class="fas fa-users"></i> Usuarios</a>
  <a href="#" class="active"><i class="fas fa-chart-bar"></i> Reportes</a>
  <a href="#"><i class="fas fa-cogs"></i> Utilidades</a>
</div>

<div class="main-content">
  <h1 class="text-3xl font-bold text-cyan-300 mb-6">Dashboard Premium de Reportes</h1>

  <!-- Estadísticas rápidas -->
  <div class="stats-grid">
    <div class="stat-card"><h2>Total Reportes</h2><p id="totalReportes" class="text-2xl font-bold">0</p></div>
    <div class="stat-card"><h2>Pendientes</h2><p id="pendientes" class="text-2xl font-bold">0</p></div>
    <div class="stat-card"><h2>Aprobados</h2><p id="aprobados" class="text-2xl font-bold">0</p></div>
    <div class="stat-card"><h2>Cerrados</h2><p id="cerrados" class="text-2xl font-bold">0</p></div>
  </div>

  <!-- Filtros -->
  <div class="flex flex-wrap gap-4 mb-4">
    <input type="text" id="searchReporte" placeholder="Buscar reporte..." class="flex-1">
    <select id="filterSucursal"><option value="">Filtrar por Sucursal</option></select>
    <select id="filterUsuario"><option value="">Filtrar por Usuario</option></select>
    <select id="filterTipo">
      <option value="">Filtrar por Tipo</option>
      <option value="Inventario">Inventario</option>
      <option value="Ventas">Ventas</option>
      <option value="Movimientos">Movimientos</option>
    </select>
    <button class="btn btn-export" onclick="exportarExcel()"><i class="fas fa-file-excel"></i> Excel</button>
    <button class="btn btn-export" onclick="exportarPDF()"><i class="fas fa-file-pdf"></i> PDF</button>
    <button class="btn btn-export" onclick="abrirModal()">Crear Reporte</button>
  </div>

  <!-- Tabla de reportes -->
  <div class="table-container">
    <table id="tablaReportes">
      <thead>
        <tr>
          <th>ID</th><th>Tipo</th><th>Fecha</th><th>Sucursal</th><th>Responsable</th><th>Estado</th><th>Detalle</th><th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tbodyReportes"></tbody>
    </table>
  </div>

  <!-- Gráficas -->
  <div class="mt-10">
    <canvas id="chartEstado" class="mb-6"></canvas>
    <canvas id="chartMovimientos"></canvas>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="cerrarModal()">&times;</span>
    <h2 class="text-xl font-bold mb-4">Crear/Editar Reporte</h2>
    <form id="formReporte" class="flex flex-col gap-3">
      <input type="hidden" id="reporteId">
      <select id="tipoReporte" required>
        <option value="">Seleccione tipo</option>
        <option value="Inventario General">Inventario General</option>
        <option value="Movimientos de Inventario">Movimientos de Inventario</option>
        <option value="Reporte de Ventas">Reporte de Ventas</option>
      </select>
      <input type="date" id="fechaReporte" required>
      <select id="sucursalReporte" required></select>
      <select id="usuarioReporte" required></select>
      <select id="estadoReporte" required>
        <option value="Pendiente">Pendiente</option>
        <option value="Aprobado">Aprobado</option>
        <option value="Cerrado">Cerrado</option>
      </select>
      <textarea id="detalleReporte" placeholder="Detalle..." rows="3"></textarea>
      <button type="submit" class="btn btn-export">Guardar Reporte</button>
    </form>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<script>
// Datos simulados
let sucursales = ['Sucursal A','Sucursal B','Sucursal C'];
let usuarios = ['Juan Pérez','Ana Gómez','Luis Torres'];
let reportes = [
  {id:1,tipo:'Inventario General',fecha:'2025-11-01',sucursal:'Sucursal A',responsable:'Juan Pérez',estado:'Pendiente',detalle:'Reporte inicial'},
  {id:2,tipo:'Movimientos de Inventario',fecha:'2025-11-02',sucursal:'Sucursal B',responsable:'Ana Gómez',estado:'Aprobado',detalle:'Movimiento de productos'},
];

// Llenar filtros
const filterSucursal=document.getElementById('filterSucursal');
sucursales.forEach(s => filterSucursal.innerHTML+=`<option value="${s}">${s}</option>`);
const filterUsuario=document.getElementById('filterUsuario');
usuarios.forEach(u => filterUsuario.innerHTML+=`<option value="${u}">${u}</option>`);

// Modal
const modal=document.getElementById('modal');
function abrirModal(){ modal.style.display='flex'; resetForm(); }
function cerrarModal(){ modal.style.display='none'; }
function showToast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }

// Render tabla y stats
function renderTabla(list=reportes){
  const tbody=document.getElementById('tbodyReportes'); tbody.innerHTML='';
  list.forEach((r,i)=>{
    tbody.innerHTML+=`<tr>
      <td>${r.id}</td>
      <td>${r.tipo}</td>
      <td>${r.fecha}</td>
      <td>${r.sucursal}</td>
      <td>${r.responsable}</td>
      <td>${r.estado}</td>
      <td>${r.detalle}</td>
      <td>
        <button class="btn-edit" onclick="editarReporte(${i})"><i class="fas fa-edit"></i></button>
        <button class="btn-delete" onclick="eliminarReporte(${i})"><i class="fas fa-trash"></i></button>
      </td>
    </tr>`;
  });
  actualizarStats(); actualizarCharts();
}
function actualizarStats(){
  document.getElementById('totalReportes').textContent=reportes.length;
  document.getElementById('pendientes').textContent=reportes.filter(r=>r.estado==='Pendiente').length;
  document.getElementById('aprobados').textContent=reportes.filter(r=>r.estado==='Aprobado').length;
  document.getElementById('cerrados').textContent=reportes.filter(r=>r.estado==='Cerrado').length;
}

// Filtrado y búsqueda
document.getElementById('searchReporte').oninput=filtrar;
filterSucursal.onchange=filterUsuario.onchange=filterTipo.onchange=filtrar;
function filtrar(){
  let term=document.getElementById('searchReporte').value.toLowerCase();
  let suc=filterSucursal.value, usu=filterUsuario.value, tipo=filterTipo.value;
  let filtered=reportes.filter(r=>
    (!suc || r.sucursal===suc) &&
    (!usu || r.responsable===usu) &&
    (!tipo || r.tipo.includes(tipo)) &&
    (Object.values(r).some(v=>v.toString().toLowerCase().includes(term)))
  );
  renderTabla(filtered);
}

// Crear/Editar reportes
const formReporte=document.getElementById('formReporte');
const sucursalReporte=document.getElementById('sucursalReporte');
const usuarioReporte=document.getElementById('usuarioReporte');
// Llenar selects modal
sucursales.forEach(s=>sucursalReporte.innerHTML+=`<option value="${s}">${s}</option>`);
usuarios.forEach(u=>usuarioReporte.innerHTML+=`<option value="${u}">${u}</option>`);

function resetForm(){ formReporte.reset(); document.getElementById('reporteId').value=''; }

formReporte.onsubmit=e=>{
  e.preventDefault();
  const id=document.getElementById('reporteId').value || Date.now();
  const nuevo={
    id:id,
    tipo:document.getElementById('tipoReporte').value,
    fecha:document.getElementById('fechaReporte').value,
    sucursal:document.getElementById('sucursalReporte').value,
    responsable:document.getElementById('usuarioReporte').value,
    estado:document.getElementById('estadoReporte').value,
    detalle:document.getElementById('detalleReporte').value
  };
  const index=reportes.findIndex(r=>r.id==id);
  if(index>=0){ reportes[index]=nuevo; showToast('Reporte actualizado'); }
  else{ reportes.push(nuevo); showToast('Reporte creado'); }
  renderTabla(); cerrarModal();
};

// Editar / Eliminar
function editarReporte(i){
  const r=reportes[i];
  document.getElementById('reporteId').value=r.id;
  document.getElementById('tipoReporte').value=r.tipo;
  document.getElementById('fechaReporte').value=r.fecha;
  document.getElementById('sucursalReporte').value=r.sucursal;
  document.getElementById('usuarioReporte').value=r.responsable;
  document.getElementById('estadoReporte').value=r.estado;
  document.getElementById('detalleReporte').value=r.detalle;
  abrirModal();
}
function eliminarReporte(i){ reportes.splice(i,1); renderTabla(); showToast('Reporte eliminado'); }

// Export
function exportarExcel(){ const ws=XLSX.utils.json_to_sheet(reportes); const wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,"Reportes"); XLSX.writeFile(wb,"Reportes_Premium.xlsx"); }
function exportarPDF(){ const { jsPDF }=window.jspdf; const doc=new jsPDF(); doc.text("Reportes Premium - Mediterranean",10,10); let y=20; reportes.forEach(r=>{ doc.text(`${r.id} | ${r.tipo} | ${r.fecha} | ${r.sucursal} | ${r.responsable} | ${r.estado}`,10,y); y+=10; }); doc.save("Reportes_Premium.pdf"); }

// Charts
let chartEstado=null, chartMovimientos=null;
function actualizarCharts(){
  // Estado
  const ctxEstado=document.getElementById('chartEstado').getContext('2d');
  const dataEstado={
    labels:['Pendiente','Aprobado','Cerrado'],
    datasets:[{label:'Estado Reportes',data:[reportes.filter(r=>r.estado==='Pendiente').length, reportes.filter(r=>r.estado==='Aprobado').length, reportes.filter(r=>r.estado==='Cerrado').length], backgroundColor:['#f59e0b','#10b981','#ef4444'] }]
  };
  if(chartEstado) chartEstado.destroy();
  chartEstado=new Chart(ctxEstado,{type:'doughnut',data:dataEstado, options:{responsive:true, plugins:{legend:{position:'bottom'}}}});

  // Movimientos por sucursal
  const ctxMov=document.getElementById('chartMovimientos').getContext('2d');
  const sucLabels=sucursales;
  const movData=sucursales.map(s=>reportes.filter(r=>r.sucursal===s && r.tipo.includes('Movimientos')).length);
  if(chartMovimientos) chartMovimientos.destroy();
  chartMovimientos=new Chart(ctxMov,{type:'bar',data:{labels:sucLabels,datasets:[{label:'Movimientos',data:movData, backgroundColor:'#0ea5e9'}]}, options:{responsive:true, plugins:{legend:{display:false}}}});
}

renderTabla();
</script>
</body>
</html>
